!function(){"use strict";const e={formElement:".form",inputElement:".form__input",submitButtonSelector:".form__submit-button",inactiveButton:"form__submit-button_invalid",inputError:"form__input_type_error",errorClass:"form__error-message"},t=document.querySelector(".profile__edit-button"),r=document.querySelector(".profile__add-button"),o=document.querySelector(".profile__avatar"),i=document.querySelector(".popup_type_edit"),s=document.querySelector(".popup_type_add"),n=document.querySelector(".popup_type_edit-avatar").querySelector(".form"),a=i.querySelector(".form"),c=s.querySelector(".form"),l=a.querySelector(".form__input_value_name"),d=a.querySelector(".form__input_value_job"),u=document.querySelector(".form__input_value_avatar"),_=c.querySelector(".form__input_value_title"),h=c.querySelector(".form__input_value_link"),p=document.querySelector(".profile__name"),m=document.querySelector(".profile__description");class f{constructor(e,t,r,o){this._title=e.title,this._link=e.link,this._cardSelector=t,this._handleCardClick=r,this._handleCardRemove=o}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".grid-item").cloneNode(!0)}_toggleLike(){this._likeButton.classList.toggle("grid-item__like_active")}removeCard(){this._element.remove(),this._element=null}_setEventListeners(){this._cardImage=this._element.querySelector(".grid-item__photo"),this._likeButton=this._element.querySelector(".grid-item__like"),this._trashIcon=this._element.querySelector(".grid-item__trash"),this._cardImage.addEventListener("click",(()=>{this._handleCardClick(this._title,this._link)})),this._likeButton.addEventListener("click",(()=>{this._toggleLike()})),this._trashIcon.addEventListener("click",(()=>{this._handleCardRemove()}))}generateCard(){return this._element=this._getTemplate(),this._setEventListeners(),this._cardTitle=this._element.querySelector(".grid-item__title"),this._cardTitle.textContent=this._title,this._cardImage.alt=this._title,this._cardImage.src=this._link,this._element}}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class b{constructor(e){v(this,"_handleEscClose",(e=>{"Escape"===e.key&&this.close()})),v(this,"_closeByOverlay",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-icon"))&&this.close()})),this._popup=document.querySelector(e)}setEventListeners(){this._popup.addEventListener("mousedown",this._closeByOverlay)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}}class y extends b{constructor(e){let{popupSelector:t,handleFormSubmit:r}=e;var o,i;super(t),i=e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this.close()},(o="_submitHandler")in this?Object.defineProperty(this,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[o]=i,this._handleFormSubmit=r,this._inputList=this._popup.querySelectorAll(".form__input"),this._form=this._popup.querySelector(".form")}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",this._submitHandler)}close(){super.close(),this._form.reset()}}class S{constructor(e,t){this._config=e,this._form=t,this._inputList=Array.from(this._form.querySelectorAll(this._config.inputElement)),this._submitButton=this._form.querySelector(this._config.submitButtonSelector)}_toggleButtonState(){this._hasInvalidInput()?(this._submitButton.classList.add(this._config.inactiveButton),this._submitButton.disabled=!0):(this._submitButton.classList.remove(this._config.inactiveButton),this._submitButton.disabled=!1)}_setEventListeners(){this._toggleButtonState(),this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_showInputError(e){e.classList.add(this._config.inputError);const t=document.querySelector(".".concat(e.id,"-error"));t.classList.add(this._config.errorClass),t.textContent=e.validationMessage}_hideInputError(e){e.classList.remove(this._config.inputError);const t=document.querySelector(".".concat(e.id,"-error"));t.classList.remove(this._config.errorClass),t.textContent=""}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}resetValidation(){this._toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._setEventListeners()}}const g=new S(e,a),E=new S(e,c),L=new S(e,n),C=new class{constructor(e,t){let{renderer:r}=e;this._renderer=r,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({renderer:e=>{const t=I(e);C.addItem(t)}},".grid-elements"),I=e=>new f(e,".item-template",q,j).generateCard(),k=new class extends b{constructor(e){super(e),this._cardImage=this._popup.querySelector(".card__picture"),this._cardTitle=this._popup.querySelector(".card__title")}open(e,t){super.open(),this._title=e,this._link=t,this._cardImage.src=this._link,this._cardTitle.textContent=this._title,this._cardImage.alt=this._title}}(".popup_type_view"),q=(e,t)=>{k.open(e,t)};k.setEventListeners();const w=new y({popupSelector:".popup_type_edit-avatar",handleFormSubmit:e=>{e={avatar:u.value},x.setProfileAvatar(e.avatar)}});w.setEventListeners();const B=new y({popupSelector:".popup_type_delete",handleFormSubmit:e=>{new f({},".item-template",q,j).removeCard()}}),j=()=>{B.open()};B.setEventListeners();const V=new y({popupSelector:".popup_type_add",handleFormSubmit:e=>{e={title:_.value,link:h.value},C.addItem(I(e))}});V.setEventListeners();const T=new y({popupSelector:".popup_type_edit",handleFormSubmit:e=>{e={user:l.value,job:d.value},x.setUserInfo(e.user,e.job)}});T.setEventListeners();const x=new class{constructor(e){let{profileName:t,profileJob:r,profileAvatar:o}=e;this._name=document.querySelector(t),this._job=document.querySelector(r),this._avatar=document.querySelector(o)}getUserInfo(){return{user:this._name.textContent,job:this._job.textContent}}setUserInfo(e,t){return this._name.textContent=e,this._job.textContent=t,this._info}setProfileAvatar(e){this._avatar.src=e}}({profileName:".profile__name",profileJob:".profile__description",profileAvatar:".profile__avatar-photo"});t.addEventListener("click",(()=>{l.value=p.textContent,d.value=m.textContent,g.resetValidation(),T.open()})),r.addEventListener("click",(()=>{E.resetValidation(),V.open()})),o.addEventListener("click",(()=>{L.resetValidation(),w.open()})),g.enableValidation(),E.enableValidation(),L.enableValidation(),new class{constructor(e){let{url:t,headers:r}=e;this._url=t,this._headers=r}getUserInfo(){return fetch(this._url,this._headers).then((e=>e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))))}getInitialCards(){return fetch("https://mesto.nomoreparties.co/v1/cohort-46/cards",{headers:{authorization:"fc76fdb8-e2ba-4757-a444-c4106fd529da"}}).then((e=>e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))))}editProfileInfo(e,t){fetch("https://mesto.nomoreparties.co/v1/cohort-46/users/me",{method:"PATCH",headers:{authorization:"fc76fdb8-e2ba-4757-a444-c4106fd529da","Content-Type":"application/json"},body:JSON.stringify({name:"Marie Skłodowska Curie",about:"Physicist and Chemist"})})}addNewCard(e,t){fetch("https://mesto.nomoreparties.co/v1/cohort-46/cards",{method:"POST",headers:{authorization:"fc76fdb8-e2ba-4757-a444-c4106fd529da"}})}deleteCard(e){fetch("https://mesto.nomoreparties.co/v1/cohort-46/cards/cardId",{method:"DELETE",headers:{authorization:"fc76fdb8-e2ba-4757-a444-c4106fd529da"}})}likeCard(){fetch("https://mesto.nomoreparties.co/v1/cohort-46/cards/cardId/likes",{method:"PUT",headers:{authorization:"fc76fdb8-e2ba-4757-a444-c4106fd529da"}})}deleteCardLike(){fetch("https://mesto.nomoreparties.co/v1/cohort-46/cards/cardId/likes",{method:"DELETE",headers:{authorization:"fc76fdb8-e2ba-4757-a444-c4106fd529da"}})}setNewAvatar(e){fetch("https://mesto.nomoreparties.co/v1/cohortId/users/me/avatar",{method:"PATCH",headers:{authorization:"fc76fdb8-e2ba-4757-a444-c4106fd529da"},body:JSON.stringify({avatar:""})})}}({apiConfig:{url:"https://mesto.nomoreparties.co/v1/cohort-46",headers:{authorization:"fc76fdb8-e2ba-4757-a444-c4106fd529da","Content-Type":"application/json"}}}).getInitialCards().then((e=>{C.renderItems(e)})).catch((e=>{console.log(e)}))}();